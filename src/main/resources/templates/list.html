<!doctype html>
<html lang="ko" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link href="/main.css" rel="stylesheet">
</head>
<body>

<div th:replace="~{ nav.html ::navbar }"> </div>

<form action="/search" method="GET">
    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
    <input name="searchText" style="display:inline">
    <button type="submit">ê²€ìƒ‰</button>
</form>

<div class="card" th:each="i : ${items}">
    <a th:href="@{'/detail/' + ${i.id} }">
        <img class="product-image" th:src="${i.imgUrl != null ? i.imgUrl : 'https://placehold.co/300'}"
            alt="ìƒí’ˆì´ë¯¸ì§€"/></a>
    <div>
        <a th:href="@{'/detail/' + ${i.id} }"><h4 th:text="${i.title}"></h4></a>
        <a th:href="@{'/detail/' + ${i.id} }"><p th:text="${#numbers.formatInteger(i.price, 3, 'COMMA') + ' â‚©'}"></p></a>
        <br>
        <!-- ê´€ë¦¬ì ë˜ëŠ” ì‘ì„±ìì¼ ê²½ìš°ë§Œ ìˆ˜ì • ì•„ì´ì½˜ í‘œì‹œ -->
        <a th:if="${#authorization.expression('hasRole(''ADMIN'')') or i.username == #authentication.name}"
           th:href="@{'/edit/' + ${i.id}}">âœï¸</a>
        <span th:if="${#authorization.expression('hasRole(''ADMIN'')') or i.username == #authentication.name}"
                style="cursor: pointer" th:inline="javascript"
              th:onclick="|fetch('/delete?id=' + [[${i.id}]], {method : 'DELETE'})
                        .then(r => r.text())
                        .then(() => {location.reload();})|">
  ğŸ—‘ï¸
</span>
    </div>
</div>


<div class="pagination">
    <a th:if="${searchText != null}"
       th:href="@{/search(searchText=${searchText}, page=${prevGroupPage})}">&lt;</a>
    <a th:if="${searchText == null}"
       th:href="@{'/list/page/' + ${prevGroupPage}}">&lt;</a>

    <!-- í˜ì´ì§€ ë²ˆí˜¸ ë°˜ë³µ -->
    <span th:each="i : ${#numbers.sequence(startPage, endPage)}">
    <a th:if="${searchText != null}"
       th:href="@{/search(searchText=${searchText}, page=${i})}"
       th:text="${i}"
       th:classappend="${i == currentPage} ? ' active' : ''"></a>

    <a th:if="${searchText == null}"
       th:href="@{'/list/page/' + ${i}}"
       th:text="${i}"
       th:classappend="${i == currentPage} ? ' active' : ''"></a>
  </span>

    <a th:if="${searchText != null}"
       th:href="@{/search(searchText=${searchText}, page=${nextGroupPage})}">&gt;</a>
    <a th:if="${searchText == null}"
       th:href="@{'/list/page/' + ${nextGroupPage}}">&gt;</a>
</div>

<script src="/nav-toggle.js"></script>
</body>
</html>